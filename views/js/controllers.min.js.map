{"version":3,"sources":["routes.js","acl.js"],"names":["define","Admin","actions","index","$","context","encode","__","loadModules","role","successCallback","empty","ajax","type","url","root_url","data","dataType","success","r","$role","html","appendTo","e","ext","groupCheckboxTitle","extra","$group","acldata","uri","click","stopPropagation","Access2None","this","Access2All","parent","hasClass","removeClass","addClass","find","m","modules","mod","modCheckboxTitle","$el","loadActions","val","module","act","actCheckBoxTitle","el","closest","actOnUri","unbind","split","action","open","each","push","elidx","selectedUri","length","i","fn","key","expr","attrHandle","elem","attr","apply","arguments","start","change","hide","show"],"mappings":"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","file":"routes.js","sourcesContent":["/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n * \r\n * \r\n */\r\n\r\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\r\ndefine('funcAcl/controller/routes',[],function(){\r\n    'use strict';\r\n\r\n    return {\r\n        'Admin' : {\r\n            'actions' : {\r\n                'index': 'controller/acl'\r\n            }\r\n        }\r\n    };\r\n});\r\n\n","define('funcAcl/controller/acl',['jquery', 'context', 'util/encode', 'i18n'], function($, context, encode, __){\r\n    \r\n    $.fn.acldata = function(key, val){\r\n            if (typeof val !== 'undefined'){\r\n                    $.expr.attrHandle[key] = function(elem){\r\n                            return $(elem).attr(key) || $(elem).data(key);\r\n                    };\r\n            }\r\n            return $.fn.data.apply(this, arguments);\r\n    };\r\n    \r\n    function loadModules(role, successCallback) {\r\n\t$('#aclModules ul.group-list').empty();\r\n\t$('#aclActions ul.group-list').empty();\r\n\t$('#aclRoles ul.included-roles').empty();\r\n\tif (role === '') return;\r\n\r\n\t$.ajax({\r\n\t\ttype: \"POST\",\r\n\t\turl: context.root_url + \"funcAcl/Admin/getModules\",\r\n\t\tdata: 'role='+role,\r\n\t\tdataType: 'json',\r\n\t\tsuccess: function(data) {\r\n\t\t\tfor (var r in data['includedRoles']) {\r\n\t\t\t\tvar $role = $('<li>'+ encode.html(data['includedRoles'][r]) +'</li>');\r\n\t\t\t\t$role.appendTo($('#aclRoles ul.included-roles'));\r\n\t\t\t}\r\n\t\t\tfor (var e in data['extensions']) {\r\n\t\t\t\tvar ext = data['extensions'][e];\r\n\t\t\t\t\r\n\t\t\t\tswitch (ext['access']) {\r\n\t\t\t\t\tcase 'inherited':\r\n\t\t\t\t\t\tgroupCheckboxTitle = __('Inherited access to the extension');\r\n\t\t\t\t\t\textra = ' has-inherited';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'full':\r\n\t\t\t\t\t\tgroupCheckboxTitle = __('Revoke access rights to the entire extension');\r\n\t\t\t\t\t\textra = ' has-allaccess';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'partial':\r\n\t\t\t\t\t\textra = ' has-access';\r\n\t\t\t\t\t\tgroupCheckboxTitle = __('Grant access rights to the entire extension');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// no access\r\n\t\t\t\t\t\textra = '';\r\n\t\t\t\t\t\tgroupCheckboxTitle = __('Grant access rights to the entire extension');\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar $group = $('<li class=\"group expendable closed'+extra+'\"><div class=\"group-title\"><span class=\"ui-icon ui-icon-triangle-1-e\"/><span class=\"title\">'+ ext['label'] +'</span>'\r\n\t\t\t\t\t\t+ '<span class=\"selector all '+(ext['access'] == 'inherited' ? 'has-inherited' : 'checkable')+'\" title=\"' + groupCheckboxTitle + '\"></span></div><ul></ul></li>');\r\n\t\t\t\t$group.acldata('uri', ext.uri);\r\n\t\t\t\t\r\n\t\t\t\tswitch (ext['access']) {\r\n\t\t\t\t\tcase 'full':\r\n\t\t\t\t\t\t$('.selector', $group).click(function (e) {\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\tAccess2None($(this))\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'partial':\r\n\t\t\t\t\t\t$('.selector', $group).click(function (e) {\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\tAccess2All($(this))\r\n\t\t\t\t\t\t});\t\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'none':\r\n\t\t\t\t\t\t// no access\r\n\t\t\t\t\t\t$('.selector', $group).click(function (e) {e.stopPropagation();Access2All($(this))});\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//Open/close group\r\n\t\t\t\t$('.group-title', $group).click(function(e) {\r\n\t\t\t\t\tif ($(this).parent().hasClass('open')){\r\n\t\t\t\t\t\t$(this).removeClass('open');\r\n\t\t\t\t\t\t$(this).parent().removeClass('open').addClass('closed');\r\n\t\t\t\t\t\t$(this).find('.ui-icon').removeClass('ui-icon-triangle-1-s').addClass('ui-icon-triangle-1-e');\r\n\t\t\t\t\t\t$(this).parent().find('.selected').removeClass('selected');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t$(this).addClass('open');\r\n\t\t\t\t\t\t$(this).parent().removeClass('closed').addClass('open');\r\n\t\t\t\t\t\t$(this).find('.ui-icon').removeClass('ui-icon-triangle-1-e').addClass('ui-icon-triangle-1-s');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tfor (var m in ext.modules) {\r\n\t\t\t\t\tvar mod = ext.modules[m];\r\n\t\t\t\t\tswitch (mod['access']) {\r\n\t\t\t\t\t\tcase 'inherited':\r\n\t\t\t\t\t\t\tmodCheckboxTitle = __('Inherited access to the controller');\r\n\t\t\t\t\t\t\textra = ' has-inherited';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'full':\r\n\t\t\t\t\t\t\tmodCheckboxTitle = __('Revoke access rights to the entire controller');\r\n\t\t\t\t\t\t\textra = ' has-allaccess';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'partial':\r\n\t\t\t\t\t\t\textra = ' has-access';\r\n\t\t\t\t\t\t\tmodCheckboxTitle = __('Grant access rights to the entire controller');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t// no access\r\n\t\t\t\t\t\t\textra = '';\r\n\t\t\t\t\t\t\tmodCheckboxTitle = __('Grant access rights to the entire controller');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar $el = $('<li class=\"selectable'+extra+'\"><span class=\"label\">'+ mod['label'] +'</span><span class=\"selector '+(mod['access'] == 'inherited' ? 'has-inherited' : 'checkable') + '\" title=\"'+ modCheckboxTitle +'\"></span></li>');\r\n\t\t\t\t\t$el.acldata('uri', mod.uri);\r\n\t\t\t\t\t\r\n\t\t\t\t\tswitch (mod['access']) {\r\n\t\t\t\t\t\tcase 'full':\r\n\t\t\t\t\t\t\t$('.selector', $el).click(function (e) {e.stopPropagation();Access2None($(this))});\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'partial':\r\n\t\t\t\t\t\t\t$('.selector', $el).click(function (e) {e.stopPropagation();Access2All($(this))});\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'none':\r\n\t\t\t\t\t\t\t// no access\r\n\t\t\t\t\t\t\t$('.selector', $el).click(function (e) {e.stopPropagation();Access2All($(this))});\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Select module\r\n\t\t\t\t\t$el.click(function() {\r\n\t\t\t\t\t\t$('#aclModules .selectable').removeClass('selected');\r\n\t\t\t\t\t\t$(this).addClass('selected');\r\n\t\t\t\t\t\tloadActions($('#roles').val(), $(this).acldata('uri'));\r\n\t\t\t\t\t});\r\n\t\t\t\t\t$el.appendTo($('ul', $group));\r\n\t\t\t\t}\r\n\t\t\t\t$group.appendTo($('#aclModules ul.group-list'));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (typeof successCallback != 'undefined'){\r\n\t\t\t\tsuccessCallback();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n    }\r\n\r\n    function loadActions(role, module, successCallback) {\r\n\t\t$.ajax({\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: context.root_url + \"funcAcl/Admin/getActions\",\r\n\t\t\tdata: 'role='+role+'&module='+module,\r\n\t\t\tdataType: 'json',\r\n\t\t\tsuccess: function(data) {\r\n\t\t\t\t$('#aclActions ul.group-list').empty();\r\n\t\t\t\tfor (e in data) {\r\n\t\t\t\t\tvar act = data[e];\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar extra = '';\r\n\t\t\t\t\tswitch (act['access']) {\r\n\t\t\t\t\t\tcase 'inherited':\r\n\t\t\t\t\t\t\tactCheckBoxTitle = __('Inherited access to the action');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'full':\r\n\t\t\t\t\t\t\textra = ' has-allaccess';\r\n\t\t\t\t\t\t\tactCheckBoxTitle = __('Revoke access rights to the action');\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t// no access\r\n\t\t\t\t\t\t\tactCheckBoxTitle = __('Grant access rights to the action');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar $el = $('<li class=\"selectable'+extra+'\"><span class=\"label\">'+ e +'</span><span class=\"selector '+(act['access'] == 'inherited' ? 'has-inherited' : 'checkable')+'\" title=\"'+ actCheckBoxTitle +'\"></span></li>');\r\n\t\t\t\t\t$el.acldata('uri', act.uri);\r\n\r\n\t\t\t\t\tswitch (act['access']) {\r\n\t\t\t\t\t\tcase 'full':\r\n\t\t\t\t\t\t\t$('.selector', $el).click(function (e) {e.stopPropagation();Access2None($(this))});\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'none':\r\n\t\t\t\t\t\t\t// no access\r\n\t\t\t\t\t\t\t$('.selector', $el).click(function (e) {e.stopPropagation();Access2All($(this))});\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t//Select action\r\n\t\t\t\t\t//$el.click(function() {\r\n\t\t\t\t\t//\t$('#aclActions .selectable').removeClass('selected');\r\n\t\t\t\t\t//\t$(this).toggleClass('selected');\r\n\t\t\t\t\t//});\r\n\t\t\t\t\t$el.appendTo($('#aclActions ul.group-list'));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (typeof successCallback !== 'undefined'){\r\n\t\t\t\t\tsuccessCallback();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n    }\r\n\r\n\t\t    function Access2All(el) {\r\n\t\t\t\t// Act\r\n\t\t\t\tvar uri = $(el).closest('li').removeClass('has-access')\r\n\t\t\t\t\t\t.addClass('has-allaccess').acldata('uri');\r\n\t\t\t\tactOnUri(uri, 'add', $('#roles').val());\r\n\t\t\t\tel.unbind('click').click(function(e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tAccess2None($(this))\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction Access2None(el) {\r\n\t\t\t\t// Act\r\n\t\t\t\tvar uri = $(el).closest('li').removeClass('has-access')\r\n\t\t\t\t\t\t.removeClass('has-allaccess').acldata('uri');\r\n\t\t\t\tactOnUri(uri, 'remove', $('#roles').val());\r\n\t\t\t\tel.unbind('click').click(function(e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tAccess2All($(this))\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\tfunction actOnUri(uri, act, role) {\r\n\t  var type = uri.split('#')[1].split('_')[0];\r\n\t\tvar action = '';\r\n\t\tswitch (type) {\r\n\t\t\tcase 'e':\r\n\t\t\t\taction = 'Extension';\r\n\t\t\t\tbreak;\r\n\t\r\n\t\t\tcase 'm':\r\n\t\t\t\taction = 'Module';\r\n\t\t\t\tbreak;\r\n\t\r\n\t\t\tcase 'a':\r\n\t\t\t\taction = 'Action';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tswitch (act) {\r\n\t\t\tcase 'add':\r\n\t\t\t\taction = \"add\"+action+\"Access\";\r\n\t\t\t\tbreak;\r\n\t\r\n\t\t\tcase 'remove':\r\n\t\t\t\taction = \"remove\"+action+\"Access\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t//Do act\r\n\t\t$.ajax({\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: context.root_url + \"funcAcl/Admin/\" + action,\r\n\t\t\tdata: 'role='+role+'&uri='+uri,\r\n\t\t\tdataType: 'json',\r\n\t\t\tsuccess: function(data) {\r\n\t\t\t\t\r\n\t\t\t\tvar open = [];\r\n\t\t\t\t$('#aclModules .group.expendable.open').each(function() {open.push($(this).index())});\r\n\t\t\t\t\r\n\t\t\t\tvar $el = $('#aclModules .selected');\r\n\t\t\t\tvar elidx;\r\n\t\t\t\tvar selectedUri = null;\r\n\t                        \r\n\t\t\t\tif ($el.length) {\r\n\t\t\t\t\tselectedUri = $el.acldata('uri');\r\n\t\t\t\t\telidx = $el.index();\r\n\t\t\t\t} else elidx = -1;\r\n\t\t\t\t\r\n\t\t\t\t// update GUI\r\n\t\t\t\tloadModules($('#roles').val(), function() {\r\n\r\n\t\t\t\t\tfor (var i in open) {\r\n\t\t\t\t\t\t$('#aclModules .group.expendable:eq('+open[i]+')').removeClass('closed')\r\n\t\t\t\t\t\t   .addClass('open')\r\n\t\t\t\t\t\t   .find('.group-title').addClass('open');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (selectedUri != null) {\r\n\t\t\t\t\t\t$('#aclModules .open li').each(function() {\r\n\t\t\t\t\t\t\tif ($(this).acldata('uri') == selectedUri) {\r\n\t\t\t\t\t\t\t\t$(this).addClass('selected');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tloadActions($('#roles').val(), selectedUri);\r\n\t\t\t\t\t\t//$('#aclModules .open li:eq('+elidx+')').addClass('selected');\r\n\t\t\t\t\t\t//loadActions($('#roles').val(), uri);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n    }\r\n    \r\n    return {\r\n        start : function(){\r\n            //Change role\r\n            $('#roles').change(function() {\r\n                    if ($('#roles').val() === ''){\r\n                        $('#roleactions').hide();\r\n                    } else {\r\n                        $('#roleactions').show();\r\n                    }\r\n                    loadModules($('#roles').val());\r\n            }).change();\r\n        }\r\n    };\r\n});\r\n\r\n\n"]}